# Threat Hunting Report - PEAK Framework

## Hunt ID: `H-0001`

## Hunt Title: SSH Brute Force Detection

---

## PREPARE: Define the Hunt

| **Hunt Information**            | **Details** |
|----------------------------------|-------------|
| **Hypothesis**                  | Adversaries use automated tools to attempt SSH authentication against Linux servers, generating patterns of failed login attempts that indicate brute force activity |
| **Threat Hunter Name**          | Security Team |
| **Date Started**                | 2025-10-22 |
| **Requestor**                   | SOC Lead |
| **Timeframe for hunt**          | Ongoing - weekly checks |

## Scoping with the ABLE Methodology

| **Field**   | **Description** | **Your Input** |
|-------------|-----------------|----------------|
| **Actor**   | Unknown threat actors conducting credential attacks | `Unknown - opportunistic attackers` |
| **Behavior**| Automated SSH brute force attempts using password guessing against Linux servers | `Password guessing via SSH (T1110.001)` |
| **Location**| Linux servers exposed to internet or internal network segments | `Production Linux servers (SSH port 22)` |
| **Evidence**| - Source: Linux auth logs (linux_secure)<br>- Key Fields: src_ip, dest_host, user, action, _time<br>- Example: Multiple failed authentication attempts from single source IP targeting multiple usernames | `- Source: linux_secure logs`<br>`- Key Fields: src_ip, dest_host, user, action`<br>`- Example: 247 failed attempts from 203.0.113.45 over 2 hours` |

## Related Tickets

| **Role**                        | **Ticket and Other Details** |
|----------------------------------|------------------------------|
| **SOC/IR**                      | Alert #2847 - SSH login anomalies detected over weekend |
| **Threat Intel (TI)**            | N/A |
| **Detection Engineering (DE)**   | To be created after hunt validation |
| **Red Team / Pen Testing**       | N/A |
| **Other**                        | N/A |

## Threat Intel & Research

- **MITRE ATT&CK Techniques:**
  - `TA0006 - Credential Access`
  - `T1110.001 - Brute Force: Password Guessing`
  - `T1078 - Valid Accounts`
- **Related Reports, Blogs, or Threat Intel Sources:**
  - Common attack pattern against internet-facing SSH
  - Known scanner activity from automated botnets
- **Historical Prevalence & Relevance:**
  - Baseline shows normal level of scanner activity
  - No previous successful SSH compromises detected
  - Current detection rules only flag excessive failures (>100)

---

## EXECUTE: Run the Hunt

### Hunting Queries

#### Initial Query (2025-10-22)

```spl
index=linux_secure sourcetype=linux_secure action=failure
| stats count as failed_attempts,
        dc(user) as unique_users,
        values(user) as attempted_users,
        earliest(_time) as first_attempt,
        latest(_time) as last_attempt
        by src_ip, dest_host
| where failed_attempts > 5
| eval duration=last_attempt-first_attempt
| eval attempts_per_minute=round(failed_attempts/(duration/60),2)
| sort - failed_attempts
| head 1000
```

- **Time Range**: -24h to now
- **Runtime**: 4.2 seconds
- **Rows Examined**: 8,432
- **Rows Returned**: 47

**Notes:**
- Query returned 47 sources with >5 failed attempts
- 42 sources were automated scanners (low attempt rate, default credentials)
- 4 sources were legitimate user errors (internal IPs, followed by successful login)
- 1 source (203.0.113.45) showed suspicious targeting with 247 failed attempts
- **Gap identified**: Too much scanner noise, threshold too low

#### Refined Query (2025-10-29)

```spl
index=linux_secure sourcetype=linux_secure action=failure
| search NOT (src_ip="10.*" OR src_ip="172.16.*" OR src_ip="192.168.*")
| stats count as failed_attempts,
        dc(user) as unique_users,
        values(user) as attempted_users,
        earliest(_time) as first_attempt,
        latest(_time) as last_attempt
        by src_ip, dest_host
| where failed_attempts > 10
| eval duration=last_attempt-first_attempt
| eval attempts_per_minute=round(failed_attempts/(duration/60),2)
| sort - failed_attempts
| head 1000
```

- **Time Range**: -24h to now
- **Runtime**: 3.8 seconds
- **Rows Examined**: 7,219
- **Rows Returned**: 12

**Rationale for Refinement:**
- Increased threshold from >5 to >10 attempts (reduce scanner noise)
- Excluded internal IP ranges (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)
- Result: 75% reduction in noise while maintaining true positive detection

**Notes:**
- All 12 remaining sources are external IPs with sustained patterns
- 8 sources targeting service accounts (jenkins, gitlab, ansible)
- All flagged IPs already blocked from previous week
- **Next refinement needed**: Add temporal logic for "newly seen" IPs

### Visualization or Analytics

- Time-series chart showing failed attempts per hour
- Source IP heatmap showing geographic distribution
- Username distribution showing targeted vs random scanning

### Detection Logic

**Initial Detection Criteria:**
- Source IP with >10 failed SSH attempts in 24 hours
- Exclude internal IP ranges
- Calculate attempt rate (sustained vs burst patterns)

**Refinements Needed:**
- Add "first seen in 7 days" filter to focus on new threats
- Whitelist known scanner IPs to reduce alert fatigue
- Add successful login after failures as escalation indicator

### Capturing Analysis & Iteration

**Week 1 (2025-10-22):**
- Found 1 confirmed brute force attempt among 47 results
- Blocked malicious IP 203.0.113.45
- Learned: Query threshold too low, internal IPs create noise

**Week 2 (2025-10-29):**
- Refined query reduced results from 47 to 12
- No new threats detected (all previously blocked IPs)
- Learned: Need temporal context to distinguish new vs known threats

**Next Steps for Refinement:**
- Add temporal logic for "newly seen source IPs"
- Consider reducing check frequency to weekly
- Validate query performance at scale before automation

---

## ACT: Findings & Response

### Hypothesis / Topic

**Hypothesis:** Adversaries use automated tools to attempt SSH authentication against Linux servers, generating patterns of failed login attempts that indicate brute force activity.

### Executive Summary

**Key Points:**
This two-week hunt investigated SSH brute force activity against Linux servers following SOC alerts. The hypothesis was **proved** - we successfully identified and blocked one active brute force attack targeting real user accounts. Initial query returned 47 sources with excessive failed attempts, but 89% were automated scanners hitting default credentials. After refining the query to increase thresholds and exclude internal IPs, we reduced noise by 75% while maintaining detection accuracy. Second week validation showed no new threats, indicating current blocking is effective but detection logic needs temporal awareness to prioritize emerging threats.

### Findings

| **Finding** | **Ticket Number and Link** | **Description** |
|------------|----------------------------|-----------------|
| Active SSH brute force from 203.0.113.45 | SOC-2847 | External IP conducted 247 failed authentication attempts over 2 hours targeting real usernames across 3 servers. Blocked at perimeter firewall. |
| Query threshold too low | DE-1023 | Initial threshold of >5 attempts captured excessive scanner noise. Increased to >10 reduced false positives by 75%. |
| Need temporal logic for detection | DE-1024 | Detection should prioritize "newly seen" source IPs vs known blocked sources to focus analyst attention on emerging threats. |
| Service account targeting | TI-445 | 8 external sources specifically targeted service accounts (jenkins, gitlab, ansible), suggesting reconnaissance of environment. Recommend rotating credentials. |

---

## KNOWLEDGE: Lessons Learned & Documentation

### Adjustments to Future Hunts

**What worked well?**
- ABLE scoping clearly defined hunt boundaries
- Iterative query refinement based on first run findings
- Threshold tuning successfully reduced noise while maintaining detection

**What could be improved?**
- Need temporal context (first seen date) in initial query design
- Should validate username existence earlier in analysis
- Consider correlation with successful logins for complete attack chain

**Should this hunt be automated as a detection?**
Yes - after adding temporal logic for "newly seen in 7 days" and whitelisting known scanners. Weekly cadence appears sufficient based on threat landscape stability.

**Are there any follow-up hunts that should be conducted?**
- Hunt for successful SSH logins after failed attempts (credential stuffing)
- Hunt for SSH connections from newly created user accounts
- Baseline service account SSH usage patterns

**What feedback should be shared with other teams?**
- **SOC**: Refined query ready for detection rule (DE-1024)
- **IR**: Service account targeting suggests recon - recommend credential rotation
- **Detection Engineering**: Template for iterative query refinement process

### Sharing Knowledge & Documentation

- [x] Write internal KB article capturing:
  - [x] Hunt objective and ABLE scoping methodology
  - [x] Query refinement process (threshold tuning, IP filtering)
  - [x] Lessons: temporal context critical for prioritization
- [x] Document detection rule improvements for DE team
- [x] Present findings at weekly hunt readout (2025-10-29)

### References

- MITRE ATT&CK T1110.001: https://attack.mitre.org/techniques/T1110/001/
- SOC Alert #2847: SSH login anomalies
- Detection Engineering ticket DE-1024: SSH brute force detection refinement
