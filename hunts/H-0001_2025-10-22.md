# H-0001 | SSH Brute Force Detection | 2025-10-22

**Status**: Completed

## Hypothesis

Adversaries use automated tools to attempt SSH authentication against Linux servers, generating patterns of failed login attempts that indicate brute force activity.

## Data Source

**Query**: `queries/H-0001.spl`
**Time Range**: -24h to now
**Runtime**: 4.2 seconds
**Rows Examined**: 8,432
**Rows Returned**: 47

## Findings

The query identified 47 source IPs with >5 failed SSH attempts over 24 hours. Analysis shows three distinct patterns of activity.

**Key Observations:**
- 42 sources (89%) are automated scanners with low attempt rates (1-3 per minute)
- 4 sources are internal IPs showing legitimate user password typos
- 1 source (203.0.113.45) shows sustained targeting with 247 failed attempts over 2 hours

**Evidence:**
- External IP 203.0.113.45 targeted 3 different servers
- Attempted usernames include real accounts (jenkins, gitlab-runner, sysadmin)
- No successful authentications from suspicious IP
- Activity occurred outside business hours (02:00-04:00 AM)

## Analysis

Most results represent background internet noise from automated scanners attempting default credentials (root, admin, test). These have short duration (<5 minutes) and sequential username patterns.

**True Positives:**
- 203.0.113.45: 247 attempts targeting real service account usernames across multiple servers. Sustained pattern over 2 hours suggests knowledge of environment. High confidence brute force.

**False Positives:**
- 4 internal IP sources were legitimate users with password typos (confirmed via successful login immediately after failures)
- 42 automated scanner sources are expected baseline activity

**Gaps:**
- Query threshold (>5 attempts) captures too much scanner noise
- No filtering for internal IP ranges
- Cannot distinguish "targeting real users" vs "random guessing" programmatically

## Decision

**Status**: [x] Accept | [ ] Reject | [ ] Needs Changes

**Reasoning**: Found one high-confidence brute force attempt targeting real accounts. Query successfully identified threat but needs refinement to reduce noise.

## Next Actions

- [x] Block 203.0.113.45 at perimeter firewall (completed 2025-10-22 06:30)
- [x] Investigate how attacker obtained valid usernames (found public GitHub repos referencing service accounts)
- [ ] Create detection rule for sustained SSH failures (>10 attempts, external IPs only)
- [ ] Rotate credentials for targeted service accounts

## Lessons Learned

Query needs refinement: increase threshold to >10 attempts and exclude internal IP ranges (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16). This would reduce false positives by ~75% while maintaining true positive detection.

**For next run:**
- Add filter: `NOT (src_ip="10.*" OR src_ip="172.16.*" OR src_ip="192.168.*")`
- Increase threshold: `where failed_attempts > 10`
- Consider adding username validation against AD to flag "real account targeting"

---

**Related Tickets**: SOC-2847 (initial alert), IR-1052 (blocked IP), DE-3041 (detection rule to be created)
**Related Hunts**: None yet
